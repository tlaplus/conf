<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=generator content="Hugo 0.85.0"><meta name=description content><meta name=author content="Markus Kuppe"><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=icon href=/images/favicon.png type=image/x-icon><title>Valentin Schneider :: TLA+ Community Event & Conference</title><link href=/css/nucleus.css rel=stylesheet><link href=/css/font-awesome.min.css rel=stylesheet><link href=/css/hybrid.css rel=stylesheet><link href=/css/featherlight.min.css rel=stylesheet><link href=/css/perfect-scrollbar.min.css rel=stylesheet><link href=/css/auto-complete.css rel=stylesheet><link href=/css/theme.css rel=stylesheet><link href=/css/hugo-theme.css rel=stylesheet><script src=/js/jquery-2.x.min.js></script><style type=text/css>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/2018/schneider2018/><nav id=sidebar><div id=header-wrapper><div id=header><img src=/tlalogo.jpg alt="TLA+ Logo"></div></div><div class=highlightable><ul class=topics><li data-nav-id=/home/ title=Home class=dd-item><a href=/home/>Home</a></li><li data-nav-id=/2023/ title="2023 - TLA+ Community Event" class=dd-item><a href=/2023/>2023 - TLA+ Community Event</a><ul><li data-nav-id=/2023/dragoischwiderski/ title class=dd-item><a href=/2023/dragoischwiderski/></a></li><li data-nav-id=/2023/olivierconstant/ title class=dd-item><a href=/2023/olivierconstant/></a></li></ul></li><li data-nav-id=/2022/ title="2022 - TLA+ Conf" class=dd-item><a href=/2022/>2022 - TLA+ Conf</a><ul></ul></li><li data-nav-id=/202110/ title="2021 - TLA+ Tutorial" class=dd-item><a href=/202110/>2021 - TLA+ Tutorial</a></li><li data-nav-id=/2024/ title="2024 - TLA+ Conf" class=dd-item><a href=/2024/>2024 - TLA+ Conf</a></li><li data-nav-id=/2021/ title="2021 - TLA+ Conf" class=dd-item><a href=/2021/>2021 - TLA+ Conf</a><ul></ul></li><li data-nav-id=/2020/ title="2020 - TLA+ Community Event" class=dd-item><a href=/2020/>2020 - TLA+ Community Event</a></li><li data-nav-id=/2019/ title="2019 - TLA+ Conf" class=dd-item><a href=/2019/>2019 - TLA+ Conf</a><ul></ul></li><li data-nav-id=/2018/ title="2018 - TLA+ Community Event" class="dd-item
parent"><a href=/2018/>2018 - TLA+ Community Event</a><ul></ul></li><li data-nav-id=/2014/ title="2014 - TLA+ Community Event" class=dd-item><a href=/2014/>2014 - TLA+ Community Event</a><ul></ul></li><li data-nav-id=/2012/ title="2012 - TLA+ Community Event" class=dd-item><a href=/2012/>2012 - TLA+ Community Event</a></li></ul><section id=footer><h4>Contact</h4>"tla2024" \o "@" \o "tlapl.us"</section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable sticky-parent"><div class=sticky-spacer><div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fa fa-bars"></i></a></span>
<span id=toc-menu><i class="fa fa-list-alt"></i></span>
<span class=links><a href=/>TLA+ Community Event & Conference</a> > <a href=/2018/>2018 - TLA+ Community Event</a> > Valentin Schneider</span></div><div align=right><h4>TLA<sup>+</sup> Conf 2024<br>Monday, April 15, 2024<br>Seattle, USA<br></h4></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#modeling-virtual-machines-and-interrupts-in-tla-and-pluscal>Modeling Virtual Machines and Interrupts in TLA+ and PlusCal</a></li></ul></li></ul></nav></div></div></div></div><div id=body-inner><h3 id=modeling-virtual-machines-and-interrupts-in-tla-and-pluscal>Modeling Virtual Machines and Interrupts in TLA+ and PlusCal</h3><h4 id=valentin-schneider>Valentin Schneider</h4><h5 id=arm-limited-uk>Arm Limited, UK</h5><p>The Arm [Generic Interrupt Controller](<a href=https://www.cl.cam.ac.uk/research/srg/han/ACS->https://www.cl.cam.ac.uk/research/srg/han/ACS-</a> P35/zynq/arm_gic_architecture_specification.pdf) (GIC) is a hardware component that manages the interrupts in a system. When there are pending interrupts (e.g. a network card has received a packet and raised an interrupt), it will signal them, which will lead to triggering a CPU exception. The GIC also provides interfaces (registers) to handle these interrupts, or even to generate new ones (software-generated interrupts).</p><p>Furthermore, the GIC includes virtualisation extensions. These extensions are used to forward interrupts to Virtual Machines (VMs, or guests), either physical (e.g. system timer) or purely virtual (e.g. virtual peripherals). This allows the hypervisor to control which interrupts are visible to the VMs.</p><p>In our case, the hypervisor is KVM ([Kernel-based Virtual Machine](<a href=https://en.wikipedia.org/wiki/Kernel->https://en.wikipedia.org/wiki/Kernel-</a> based_Virtual_Machine)), a virtualisation solution used within the Linux Kernel.</p><p>The use of the virtual extensions is not limited to simply forwarding interrupts. A VM needs to be oblivious to which physical CPU it is running on, yet the GIC interfaces are per-CPU. Should we be running a VM with several virtual CPUs (vCPUs) on a single core system, we would need to save and restore the state of the sole CPU interface depending on which vCPU is being run. The hypervisor is tasked with handling these GIC context switches.</p><p>This work thus involves two models:</p><ul><li><p>A GIC model written in TLA+, which models interrupt states, interrupt signals, active priorities, etc.</p></li><li><p>A KVM model written in PlusCal, which models the different software context switches (Interrupt handler, hypervisor, VM/Guest) as well as the handling of interrupts and interactions with the GIC by both the hypervisor and the VMs.</p></li></ul><p>To make these interactions possible, the GIC specification and the KVM specification share a communication channel. For instance, to write to a register, the KVM specification will append the name of the register and the data to write to a command queue.</p><p>The presence of data on this command queue is an enabling condition of a step in the GIC specification that will consume the command, update the internal GIC state and append a reply to the communication channel.</p><p>Finally, both the KVM and the GIC specifications are conjoined with a common next-state relation. The resulting specification describes behaviors where KVM and the GIV interact via that communication channel.</p><p>Using TLC, the goal is to verify:</p><ul><li><p>Safety properties such as interrupts delivered to the correct guests, recovering from misbehaving guests not signalling the end of interrupt, correct context switching of multiple vCPUs running on a physical CPU, correct migration of a vCPU to a different physical CPU.</p></li><li><p>Liveness properties such as deadlock freedom, interrupts eventually delivered to a guest.</p></li></ul><footer class=footline></footer></div></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/perfect-scrollbar.min.js></script><script src=/js/perfect-scrollbar.jquery.min.js></script><script src=/js/html5shiv-printshiv.min.js></script><script src=/js/modernizr.custom.71422.js></script><script src=/js/learn.js></script><script src=/js/hugo-learn.js></script><link href=/mermaid/mermaid.css type=text/css rel=stylesheet><script src=/mermaid/mermaid.js></script><script>mermaid.initialize({startOnLoad:!0})</script><link href=/css/bootstrap.css rel=stylesheet><script src=/js/bootstrap.min.js></script></body></html>